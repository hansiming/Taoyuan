<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
				  
<mapper namespace="com.csdhsm.taoyuan.mapper.UserMapper">
	
	<resultMap id="userLogin" type="com.csdhsm.taoyuan.models.UserLogin">
		<id column="id" property="id" />
		<result column="userName" property="userName" />
		<result column="pwd" property="pwd" />
		<result column="userStatusId" property="userStatusId" />
	</resultMap>
	
	<!-- ��������������������������������?��������������������?,������0������������������ -->
	<select id="checkUserNameExist" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM userlogin WHERE username = #{userName};
	</select>
	
	<!-- ������������������������������,��������������������?,������0������������������ -->
	<select id="checkUserEmailExist" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM userlogin WHERE email = #{email};
	</select>
	
	<!-- ���������������������������������Id -->
	<select id="getUserIdByVcode" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT userId FROM UserComfirmCode WHERE vcode = #{vcode};
	</select>
	
	<select id="getUserInfoByUserId"  parameterType="java.lang.Integer" resultType="com.csdhsm.taoyuan.models.UserInfo">
		SELECT * FROM userInfo WHERE userId = #{userId}
	</select>
	
	<!-- ����������������?��������������?-->
	<select id="loginByEmailOrUserName" parameterType="com.csdhsm.taoyuan.models.UserLogin" resultType="com.csdhsm.taoyuan.models.UserLogin">
		select * from userLogin where (userName = #{userName} or email = #{email}) and pwd = #{pwd};
	</select>
	
	<!-- ������������ID������UserLogin -->
	<select id="getUserLoginByUserId" parameterType="java.lang.Integer" resultType="com.csdhsm.taoyuan.models.UserLogin">
		SELECT * FROM UserLogin WHERE id = #{userId};
	</select>
	
	<!-- ��������������������������������?-->
	<update id="updateUserStatusId" parameterType="java.lang.Integer">
		UPDATE userLogin SET userStatusId = 1 WHERE id = #{userId};
	</update>
	
	<!-- ������������,������������Id -->
	<insert id="register" parameterType="com.csdhsm.taoyuan.models.UserLogin" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO userlogin (userName,pwd,userStatusId,email) VALUES(#{userName}, #{pwd}, #{userStatusId}, #{email});
	</insert>
	
	<!-- ������������������������������������ -->
	<insert id="addVcode" parameterType="com.csdhsm.taoyuan.models.UserComfirmCode" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO UserComfirmCode(userId, vcode) VALUES(#{userId}, #{vcode});
	</insert>
	
	<!-- ������������������ -->
	<insert id="addUserInfo" parameterType="com.csdhsm.taoyuan.models.UserInfo" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO userinfo (headImage, gender, realName, telePhone, userId)
		VALUES(#{headImage}, null, null, null, #{userId});
	</insert>
</mapper>